<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Admin ‚Äì Queue</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 p-4">

<h1 class="text-2xl font-bold mb-4">üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß (Admin)</h1>

<div class="mb-4 space-x-2">
  <button onclick="loadQueues()" class="bg-blue-600 text-white px-4 py-2 rounded">
    üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏¥‡∏ß
  </button>
  <button onclick="resetQueue()" class="bg-red-600 text-white px-4 py-2 rounded">
    ‚ôªÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  </button>
</div>

<div class="overflow-x-auto bg-white rounded shadow">
<table class="w-full text-sm">
  <thead class="bg-gray-200">
    <tr>
      <th class="p-2">‡∏Ñ‡∏¥‡∏ß</th>
      <th>‡∏ä‡∏∑‡πà‡∏≠</th>
      <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå</th>
      <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
      <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
    </tr>
  </thead>
  <tbody id="queueTable"></tbody>
</table>
</div>

<script>
function loadQueues() {
  google.script.run.withSuccessHandler(render)
    .getAllQueues();
}

function render(data) {
  const tbody = document.getElementById("queueTable");
  tbody.innerHTML = "";

  data.forEach(row => {
    const tr = document.createElement("tr");
    tr.className = "border-t";

    tr.innerHTML = `
      <td class="p-2 font-bold">A${("00"+row[2]).slice(-3)}</td>
      <td>${row[4]}</td>
      <td>${row[5]}</td>
      <td>${row[3]}</td>
      <td class="space-x-1">
        <button onclick="setStatus(${row[2]},'Called')" class="bg-green-500 text-white px-2 py-1 rounded">‡πÄ‡∏£‡∏µ‡∏¢‡∏Å</button>
        <button onclick="setStatus(${row[2]},'Skipped')" class="bg-yellow-500 text-white px-2 py-1 rounded">‡∏Ç‡πâ‡∏≤‡∏°</button>
        <button onclick="setStatus(${row[2]},'Done')" class="bg-gray-500 text-white px-2 py-1 rounded">‡πÄ‡∏™‡∏£‡πá‡∏à</button>
        <button onclick="del(${row[2]})" class="bg-red-600 text-white px-2 py-1 rounded">‡∏•‡∏ö</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function setStatus(q, status) {
  google.script.run.withSuccessHandler(loadQueues)
    .updateQueueStatus(q, status);
}

function del(q) {
  if (confirm("‡∏•‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏ô‡∏µ‡πâ?")) {
    google.script.run.withSuccessHandler(loadQueues)
      .deleteQueue(q);
  }
}

function resetQueue() {
  if (confirm("‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) {
    google.script.run.withSuccessHandler(loadQueues)
      .resetQueue();
  }
}

loadQueues();
</script>

</body>
</html>
